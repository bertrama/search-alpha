<!DOCTYPE html>
<title>Loading...</title>
<script src="src/js/mithril.js"></script>
<script src="src/js/underscore.js"></script>
<script>

var Record = {
    controller: function(args) {
        return args
    },
    view: function(ctrl) {
        return m("li.item", [
            m("h3", ctrl.title),
            m("dl",
                _.reduce(ctrl.meta, function(memo, field_value, field_name) {
                    memo.push(
                        m("dt", field_name),
                        m("dd", field_value)
                    )
                    return memo
                }, [])
            )
        ])
    }
}

var Records = {
    controller: function() {
        return [
            {
                title: 'Prussia',
                meta: {
                    "By": "United States. Department of State.",
                    "Published": "1799, Washington : [s.n.], 1799.",
                    "Format": "Book, Available Online"
                }
            },
            {
                title: 'Prussia : the history of a lost state / Rudolf von Thadden ; translated by Angi Rutter.',
                meta: {
                    "Main Author": "Thadden, Rudolf von.",
                    "Format": "Book",
                    "Language": "English, German",
                    "Published": "1987, Cambridge [Cambridgeshire] ; New York, NY, USA : Cambridge University Press ; Paris : Editions de la Maison des sciences de l'homme, 1987."
                }
            },
            {
                title: "Prussia : the history of a lost state",
                meta: {
                    "Author": "Thadden, Rudolf von.",
                    "Published": "1987",
                    "Format": "Book"
                }
            }
        ]
    },
    view: function(ctrl) {
        return m(".search-results", [
            m("ul.items", [
                _.map(ctrl, function(record) {
                    return m.component(Record, record)
                })
            ])
        ])
    }
}

var Field = {
    controller: function(args) {
        return args
    },
    view: function(ctrl) {
        return m("option", ctrl.name)
    }
}

var Fields = {
    controller: function(args) {
        return [
            {name: 'Quicksearch'},
            {name: 'Catalog'},
            {name: 'Articles'},
            {name: 'Databases'},
            {name: 'Online Fournals'},
            {name: 'Library Website'}
        ]
    },
    view: function(ctrl) {
        return m("select.fields", [
            _.map(ctrl, function(field) {
                return m.component(Field, field)
            })
        ])
    }
}

var Datastore = {
    controller: function(args) {
        return args
    },
    view: function(ctrl) {
        return m("li", ctrl.name)
    }
}

var Datastores = {
    controller: function() {
        return [
            {name: 'Quicksearch'},
            {name: 'Catalog'},
            {name: 'Articles'},
            {name: 'Databases'},
            {name: 'Online Fournals'},
            {name: 'Library Website'}
        ]
    },
    view: function(ctrl) {
        return m("ul.datastores", [
            _.map(ctrl, function(datastore) {
                return m.component(Datastore, datastore)
            })
        ])
    }
}

var Head = {
    view: function() {
        return m("head", [
            m("title", "Search [Alpha]"),
            m("link[href='https://fonts.googleapis.com/css?family=Open+Sans:400,700'][rel='stylesheet']"),
            m("link[href='src/css/styles.css'][rel='stylesheet']")
        ])
    }
}

var SearchInput = {
    view: function() {
        return m(".search", [
            m("form", [
                m("input[type='text']"),
                m.component(Fields),
                m("input[type='submit'][value='Search']")
            ])
        ])
    }
}

var App = {
    fields: function() {
        return [
            {name: "All Fields"},
            {name: "Title"},
            {name: "Author"}
        ]
    },
    view: function() {
        return m("html", [
            m.component(Head),
            m("body", [
                m("header", [
                    m(".container", [
                        m.component(SearchInput),
                    ])
                ]),
                m(".container", [
                    m("aside", [
                        m.component(Datastores)
                    ]),
                    m("main", [
                        m(".search-info", [
                            "results: ",
                            m("b", "0")
                        ]),
                        m.component(Records)
                    ])
                ])
            ])
        ])
    }
}


m.mount(document, App)

</script>